kagglehub
import pandas as pd
import matplotlib.pyplot as plt
from reportlab.lib.pagesizes import A4
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Image
from reportlab.lib.styles import getSampleStyleSheet

path = kagglehub.dataset_download("vivek468/superstore-dataset-final")
df = pd.read_csv(path + "/SampleSuperstore.csv")


df = df.drop_duplicates()

df = df.dropna()


df['Order Date'] = pd.to_datetime(df['Order Date'])
df['Ship Date'] = pd.to_datetime(df['Ship Date'])


num_cols = ['Sales', 'Profit', 'Discount', 'Quantity']
df[num_cols] = df[num_cols].apply(pd.to_numeric)


df['Profit Margin %'] = (df['Profit'] / df['Sales']) * 100
df['Ship Days'] = (df['Ship Date'] - df['Order Date']).dt.days


def save_chart(fig, filename):
    fig.savefig(filename, bbox_inches="tight")
    plt.close(fig)

fig1, ax1 = plt.subplots()
df.groupby("Category")["Sales"].sum().plot(kind="bar", ax=ax1, title="Sales by Category")
ax1.set_ylabel("Sales")
save_chart(fig1, "chart1.png")


fig2, ax2 = plt.subplots()
df.groupby("Region")["Profit"].sum().plot(kind="bar", ax=ax2, color="orange", title="Profit by Region")
ax2.set_ylabel("Profit")
save_chart(fig2, "chart2.png")


fig3, ax3 = plt.subplots()
df.groupby("Segment")["Sales"].sum().plot(kind="pie", autopct='%1.1f%%', ax=ax3, title="Sales Share by Segment")
ax3.set_ylabel("")
save_chart(fig3, "chart3.png")


fig4, ax4 = plt.subplots()
df["Profit Margin %"].plot(kind="hist", bins=10, ax=ax4, title="Profit Margin % Distribution")
ax4.set_xlabel("Profit Margin %")
save_chart(fig4, "chart4.png")


pdf_file = "Superstore_Summary.pdf"
doc = SimpleDocTemplate(pdf_file, pagesize=A4)
styles = getSampleStyleSheet()
story = []

story.append(Paragraph("ðŸ“Š Superstore Sales Insights Summary", styles['Title']))
story.append(Spacer(1, 12))

# Insights text

story.append(Paragraph(insights_text, styles['Normal']))
story.append(Spacer(1, 12))

# Add Charts
for i in range(1, 5):
    story.append(Image(f"chart{i}.png", width=400, height=250))
    story.append(Spacer(1, 12))
